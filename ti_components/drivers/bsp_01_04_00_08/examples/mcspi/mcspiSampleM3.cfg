/* ========================================================================== */
/*                      CFG script for the McSPI sample                       */
/* ========================================================================== */

/* Load the AMMU cfg file                                                     */
var AmmuCfg = xdc.loadCapsule("AmmuCfg.cfg");

/* load the required files and packages                                       */
var Task         = xdc.useModule ("ti.sysbios.knl.Task");
var BIOS         = xdc.useModule ("ti.sysbios.BIOS");
var Startup      = xdc.useModule ("xdc.runtime.Startup");
var timestamp    = xdc.useModule ("xdc.runtime.Timestamp");
var Cache        = xdc.useModule ("ti.sysbios.hal.Cache");
var Semaphore    = xdc.useModule ("ti.sysbios.knl.Semaphore");
var Hwi          = xdc.useModule ('ti.sysbios.hal.Hwi');
var Swi          = xdc.useModule ("ti.sysbios.knl.Swi");
var Assert       = xdc.useModule ('xdc.runtime.Assert');
var Log          = xdc.useModule ('xdc.runtime.Log');
var LoggerBuf    = xdc.useModule ('xdc.runtime.LoggerBuf');
var Memory       = xdc.useModule ('xdc.runtime.Memory')
var SysMin       = xdc.useModule ('xdc.runtime.SysMin');
var System       = xdc.useModule ('xdc.runtime.System');
var Defaults     = xdc.useModule ('xdc.runtime.Defaults');
var Main         = xdc.useModule ('xdc.runtime.Main');
var Diags        = xdc.useModule ('xdc.runtime.Diags');
var SysStd      = xdc.useModule("xdc.runtime.SysStd");
var Core         = xdc.useModule ("ti.sysbios.family.arm.ducati.Core");
var HwiM3        = xdc.useModule ('ti.sysbios.family.arm.m3.Hwi');
var Intmux       = xdc.useModule ('ti.sysbios.family.arm.ducati.dm8148.IntMux');
BIOS.smpEnabled = false;
Task.defaultAffinity = 0;

/* System stack size (used by ISRs and Swis) */
Program.stack = 0x6000;

/*
 * Create and install logger for the whole system
 */
var loggerBufParams = new LoggerBuf.Params();
loggerBufParams.numEntries = 32;
var logger0 = LoggerBuf.create(loggerBufParams);
Defaults.common$.logger = logger0;
Main.common$.diags_INFO = Diags.ALWAYS_ON;

System.SupportProxy = SysStd;

var GIO = xdc.useModule('ti.sysbios.io.GIO');

var iomFxns = "Mcspi_IOMFXNS";
var initFxn = "user_mcspi_init";
var deviceParams = "mcspiPrms";
var deviceId = 0;

GIO.addDeviceMeta("/mcspi0", iomFxns, initFxn, deviceId, deviceParams);

var task0Params = new Task.Params();
task0Params.instance.name = "task0";
task0Params.stackSize = 0x2000;
task0Params.affinity = 0; /* Force to run on Core 0 */
Program.global.task0 = Task.create("&spiSampleTask", task0Params);

/* configure the required Heap parameters                                     */
var HeapMem = xdc.useModule('ti.sysbios.heaps.HeapMem');
var prms = new HeapMem.Params;
prms.size = 8192;
var heap = HeapMem.create(prms);

var Memory = xdc.useModule('xdc.runtime.Memory');
Memory.defaultHeapInstance = heap;

/* MMU/Cache related configurations                                           */
var Cache1  = xdc.useModule('ti.sysbios.hal.unicache.Cache');
var Mmu     = xdc.useModule('ti.sysbios.hal.ammu.AMMU');
AmmuCfg.init();

/* Enable the cache                                                           */
Cache1.enableCache = true;

/* Configure the .text section to DDR3                                        */

Program.sectMap[".text"]  = "DSS_M3_CODE_MEM";
Program.sectMap[".const"] = "DSS_M3_CODE_MEM";
Program.sectMap[".plt"]   = "DSS_M3_CODE_MEM";
