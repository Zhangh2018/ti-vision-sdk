<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>NDK: sntp.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NDK
   &#160;<span id="projectnumber">2.24.02.31</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2298ed0e5bfee6f293aea6c715ac7f7c.html">exports</a></li><li class="navelem"><a class="el" href="dir_1021f93d0b96307b7d5f62de93307e11.html">ndk_2_24_02_31</a></li><li class="navelem"><a class="el" href="dir_16c225f92d85c2647011474909c4aadf.html">packages</a></li><li class="navelem"><a class="el" href="dir_3f051719e97ef21bd60ea5e21f7dc6b4.html">ti</a></li><li class="navelem"><a class="el" href="dir_4af44f8452c145eb95f06f7fdbc159e6.html">ndk</a></li><li class="navelem"><a class="el" href="dir_8aa605f920672f9d1f8eefe318f025c9.html">nettools</a></li><li class="navelem"><a class="el" href="dir_0f16ffeaa3f2b1f072efa08face48775.html">sntp</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sntp.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is a 'beta' release of SNTP client.</p>
<p>The SNTP client uses the Network Time Protocol (NTP) to provide a continuous service of maintaining system time by periodically sychronizing with one or more NTP servers.</p>
<p>To implement the SNTP client service, the user is required to provide two system time keeping functions, as well as a list of NTP server IP addresses.</p>
<p>The time keeping functions are called by the SNTP client in order to get or set the current time in the system ("gettime" and "settime"). For example, these could be APIs which set or get the value of a Real Time Clock (RTC). The "gettime" and "settime" functions should have the following format and should be passed into the <a class="el" href="sntp_8h.html#a0b8765ce6d90d7d171d740b2eedde328" title="Initialize and start the SNTP client Task. ">SNTP_start()</a> function: </p><div class="fragment"><div class="line">uint32_t (*GetTimeFxn)(void);</div>
<div class="line">void (*SetTimeFxn)(uint32_t newtime);</div>
</div><!-- fragment --><p>The "gettime" function should return the number of seconds since the Epoch (January 1, 1970). The "settime" function sets the time to the value that is passed to it. The SNTP client uses the "gettime" function to write the current system time into a request to an NTP server. The "settime" function is used to set the system time to a new value received from the NTP server. The SNTP client handles the conversion of NTP time (time since January 1, 1900) to the local system's time (number of seconds since January 1, 1970).</p>
<p>The list of NTP servers should consist of socket address structures which contain the unicast addresses of the servers (as well as some additional information). Both IPv4 and IPv6 unicast server addresses are supported (host names are not supported). Structures of type 'struct sockaddr_in' must be used for IPv4 server addresses and of type 'struct sockaddr_in6' for IPv6 server addresses. These structures must be written to a contiguous block of memory and then passed to the <a class="el" href="sntp_8h.html#a34409ecc254ee5abf525c69909d3df59" title="Initializes or updates the list of NTP servers to communicate with. ">SNTP_setservers()</a> function.</p>
<p>The SNTP client may be stopped by calling <a class="el" href="sntp_8h.html#aaab818e780a8ec9e87aa39a4d9a31f89" title="Stops the SNTP client Task and frees resources used by the module. ">SNTP_stop()</a>. Calling this function will cause the SNTP client Task to exit and all of the resources used by it to be freed.</p>
<h1>Example Usage</h1>
<p>The SNTP module is part of the NDK nettools library. An application should include its header file as follows: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sntp_8h.html">ti/ndk/nettools/sntp/sntp.h</a>&gt;</span></div>
</div><!-- fragment --><h2>Setting The Time Functions And Starting The SNTP Client Service</h2>
<p>The SNTP client should be initialized by calling the <a class="el" href="sntp_8h.html#a0b8765ce6d90d7d171d740b2eedde328" title="Initialize and start the SNTP client Task. ">SNTP_start()</a> function. Pointers to the set and get time functions should be passed as arguments, as well as the stack size to be used for the client Task, if desired. The following example code passes pointers to some existing time functions 'gettime' and 'settime'. A value of 0 is passed as the last argument, which specifies that the default stack size for the SNTP client Task should be used: </p><div class="fragment"><div class="line"><a class="code" href="sntp_8h.html#a0b8765ce6d90d7d171d740b2eedde328">SNTP_start</a>(gettime, settime, 0);</div>
</div><!-- fragment --><h2>Initializing The List Of Servers Using Socket Address Structures</h2>
<p>The server list should be initialized and passed to the SNTP module via the <a class="el" href="sntp_8h.html#a34409ecc254ee5abf525c69909d3df59" title="Initializes or updates the list of NTP servers to communicate with. ">SNTP_setservers()</a> API. The following code uses socket address structs to store the IPv4 and IPv6 addresses of some (imaginary) NTP servers. Note that it is no longer necessary to set the size of the address structure via the sin_len and sin6_len fields of the socket address structures. When the length fields were removed from the definition of the socket address structures in NDK 2.24, the SNTP module was updated to handle cycling through the server_list based on the family type of the current address structure in the list.</p>
<p>Therefore, the family, port, IP address and scope ID (for IPv6 only) must be correctly set: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ti/ndk/inc/netmain.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ti/ndk/inc/_stack.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>sockaddr_in  ipv4addr;</div>
<div class="line"><span class="keyword">struct </span>sockaddr_in6 ipv6addr;</div>
<div class="line"></div>
<div class="line">ipv4addr.sin_family = AF_INET;</div>
<div class="line">ipv4addr.sin_port = htons(123);</div>
<div class="line">ipv4addr.sin_addr.s_addr = inet_addr(<span class="stringliteral">&quot;192.168.1.100&quot;</span>);</div>
<div class="line"></div>
<div class="line">ipv6addr.sin6_family = AF_INET6;</div>
<div class="line">ipv6addr.sin6_port = htons(123);</div>
<div class="line">IPv6StringToIPAddress(<span class="stringliteral">&quot;fe80::dbff:b21b:fe78:20b&quot;</span>,</div>
<div class="line">        (IP6N *)&amp;ipv6addr.sin6_addr);</div>
<div class="line">ipv6addr.sin6_scope_id = 1;</div>
</div><!-- fragment --><h2>Storing The Server List In A Contiguous Block Of Memory</h2>
<p>Once the address structures are properly initialized, they need to be written into a contiguous block of memory. This can be done copying the address structures into a byte array: </p><div class="fragment"><div class="line"><span class="preprocessor">#define SIZE (sizeof(struct sockaddr_in) + sizeof(struct sockaddr_in6))</span></div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ntpServers[SIZE];</div>
<div class="line"><span class="keywordtype">int</span> currPos = 0;</div>
<div class="line"></div>
<div class="line">memcpy((ntpServers + currPos), &amp;ipv4addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));</div>
<div class="line">currPos += <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in);</div>
<div class="line"></div>
<div class="line">memcpy((ntpServers + currPos), &amp;ipv6addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in6));</div>
<div class="line">currPos += <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in6);</div>
</div><!-- fragment --><h2>Passing The Server List To The SNTP Module</h2>
<p>To set the list of NTP servers, call <a class="el" href="sntp_8h.html#a34409ecc254ee5abf525c69909d3df59" title="Initializes or updates the list of NTP servers to communicate with. ">SNTP_setservers()</a>, passing the server list and the number of servers in the list as arguments. Note that the server list is cast to the generic type of 'struct sockaddr *': </p><div class="fragment"><div class="line"><a class="code" href="sntp_8h.html#a34409ecc254ee5abf525c69909d3df59">SNTP_setservers</a>((<span class="keyword">struct</span> sockaddr *)ntpServers, 2);</div>
</div><!-- fragment --><h2>Stopping The SNTP Client Service</h2>
<p>To stop the SNTP client, the <a class="el" href="sntp_8h.html#aaab818e780a8ec9e87aa39a4d9a31f89" title="Stops the SNTP client Task and frees resources used by the module. ">SNTP_stop()</a> function is called: </p><div class="fragment"><div class="line"><a class="code" href="sntp_8h.html#aaab818e780a8ec9e87aa39a4d9a31f89">SNTP_stop</a>();</div>
</div><!-- fragment --> <hr/>
</div><div class="textblock"><code>#include &lt;xdc/std.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sntp.h:</div>
<div class="dyncontent">
<div class="center"><img src="sntp_8h__incl.png" border="0" usemap="#sntp_8h" alt=""/></div>
<map name="sntp_8h" id="sntp_8h">
</map>
</div>
</div>
<p><a href="sntp_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0b8765ce6d90d7d171d740b2eedde328"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sntp_8h.html#a0b8765ce6d90d7d171d740b2eedde328">SNTP_start</a> (uint32_t(*get)(void), void(*set)(uint32_t newtime), size_t stacksize)</td></tr>
<tr class="memdesc:a0b8765ce6d90d7d171d740b2eedde328"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize and start the SNTP client Task.  <a href="#a0b8765ce6d90d7d171d740b2eedde328">More...</a><br /></td></tr>
<tr class="separator:a0b8765ce6d90d7d171d740b2eedde328"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaab818e780a8ec9e87aa39a4d9a31f89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sntp_8h.html#aaab818e780a8ec9e87aa39a4d9a31f89">SNTP_stop</a> (void)</td></tr>
<tr class="memdesc:aaab818e780a8ec9e87aa39a4d9a31f89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the SNTP client Task and frees resources used by the module.  <a href="#aaab818e780a8ec9e87aa39a4d9a31f89">More...</a><br /></td></tr>
<tr class="separator:aaab818e780a8ec9e87aa39a4d9a31f89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34409ecc254ee5abf525c69909d3df59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sntp_8h.html#a34409ecc254ee5abf525c69909d3df59">SNTP_setservers</a> (struct sockaddr *servers, unsigned int numservers)</td></tr>
<tr class="memdesc:a34409ecc254ee5abf525c69909d3df59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes or updates the list of NTP servers to communicate with.  <a href="#a34409ecc254ee5abf525c69909d3df59">More...</a><br /></td></tr>
<tr class="separator:a34409ecc254ee5abf525c69909d3df59"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0b8765ce6d90d7d171d740b2eedde328"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SNTP_start </td>
          <td>(</td>
          <td class="paramtype">uint32_t(*)(void)&#160;</td>
          <td class="paramname"><em>get</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(uint32_t newtime)&#160;</td>
          <td class="paramname"><em>set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stacksize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize and start the SNTP client Task. </p>
<p>Called to create and start SNTP client Task and Semaphores. User must pass in pointers to functions for getting and setting the current time.</p>
<p>The SNTP client Task's stacksize is configurable via the stacksize parameter.</p>
<p>Passing a value of 0 for the stack parameter causes the Task to be created with a default value. Passing a value &gt; 0 causes the Task to be created using that value for the stack size. When a value &gt; 0 is passed, it is the application developer's responsiblity to choose an appropriate stack size. If this is not done, stack overflow or other undesirable behavior may occur.</p>
<p>The priority of SNTP_synctime is set to 1 and is not configurable.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">get</td><td>A pointer to a function that returns the number of seconds since January 1, 1970</td></tr>
    <tr><td class="paramname">set</td><td>A pointer to a function that sets the time to the supplied value</td></tr>
    <tr><td class="paramname">stacksize</td><td>Stack size to use for the SNTP client Task. Passing a value of 0 allows a default to be used.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure and 1 on success </dd></dl>

</div>
</div>
<a class="anchor" id="aaab818e780a8ec9e87aa39a4d9a31f89"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SNTP_stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops the SNTP client Task and frees resources used by the module. </p>

</div>
</div>
<a class="anchor" id="a34409ecc254ee5abf525c69909d3df59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SNTP_setservers </td>
          <td>(</td>
          <td class="paramtype">struct sockaddr *&#160;</td>
          <td class="paramname"><em>servers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>numservers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes or updates the list of NTP servers to communicate with. </p>
<p>Must call <a class="el" href="sntp_8h.html#a0b8765ce6d90d7d171d740b2eedde328" title="Initialize and start the SNTP client Task. ">SNTP_start()</a> first. This function is used to set the list of NTP servers initially, or to update the list of servers at a later point in the application run.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">servers</td><td>A pointer to a contiguous block of memory which contains a list of sockaddr_in and/or sockaddr_in6 structures</td></tr>
    <tr><td class="paramname">numservers</td><td>The number of servers (structs) contained in the server list </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><small>
Copyright  2015, Texas Instruments Incorporated
</small>
</body>
</html>
